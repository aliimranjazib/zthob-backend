{% extends "admin/base_site.html" %}

{% block content %}
<div class="module">
    <h1>{{ title }}</h1>

    <form method="get" style="margin: 20px 0; padding: 15px; background: #f8f8f8; border-radius: 4px;">
        <label for="days">Select Period:</label>
        <select name="days" style="padding: 5px 10px;">
            <option value="7">Last 7 days</option>
            <option value="30" selected>Last 30 days</option>
            <option value="90">Last 90 days</option>
        </select>
        <button type="submit"
            style="padding: 5px 15px; margin-left: 10px; background: #417690; color: white; border: none; border-radius: 3px;">Update</button>
        <a href="{% url 'admin:orders-analytics' %}?days={{ days }}"
            style="margin-left: 20px; padding: 5px 15px; text-decoration: none;">‚Üê Back to Dashboard</a>
    </form>


    <h2>Top Selling Fabrics</h2>
    {% if fabrics_data %}
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 40px;">
        <thead>
            <tr style="background: #417690; color: white;">
                <th style="padding: 12px; text-align: left;">Fabric</th>
                <th style="padding: 12px; text-align: left;">Tailor</th>
                <th style="padding: 12px; text-align: right;">Quantity</th>
                <th style="padding: 12px; text-align: right;">Orders</th>
                <th style="padding: 12px; text-align: right;">Revenue</th>
            </tr>
        </thead>
        <tbody>
            {% for fabric in fabrics_data %}
            <tr {% if forloop.counter|divisibleby:2 %}style="background: #f8f8f8;" {% endif %}>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">
                    <strong>{{ fabric.fabric_name }}</strong><br>
                    <small style="color: #666;">SKU: {{ fabric.fabric_sku }}</small>
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">{{ fabric.tailor_username }}</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">{{ fabric.total_quantity }}
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">{{ fabric.orders_count }}
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right; color: #28a745;"><strong>{{ fabric.total_revenue }} SAR</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="padding: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px; margin-bottom: 40px;">
        No fabric sales data found for this period.</p>
    {% endif %}


    <h2>Trending Tags</h2>
    {% if tags_data %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #417690; color: white;">
                <th style="padding: 12px; text-align: left;">Tag</th>
                <th style="padding: 12px; text-align: right;">Orders</th>
                <th style="padding: 12px; text-align: right;">Quantity</th>
                <th style="padding: 12px; text-align: right;">Revenue</th>
            </tr>
        </thead>
        <tbody>
            {% for tag in tags_data %}
            <tr {% if forloop.counter|divisibleby:2 %}style="background: #f8f8f8;" {% endif %}>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;"><strong>{{ tag.tag_name }}</strong></td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">{{ tag.total_orders }}</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">{{ tag.total_quantity }}
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right; color: #28a745;"><strong>{{ tag.total_revenue }} SAR</strong></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="padding: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">No tag data found for
        this period.</p>
    {% endif %}

    <p style="margin-top: 30px; color: #666; font-size: 12px;">
        <em>Data is cached for 5 minutes. Showing top {{ limit }} items for last {{ days }} days.</em>
    </p>
</div>
{% endblock %}