{% extends "admin/base_site.html" %}

{% block content %}
<div class="module">
    <h1>{{ title }}</h1>

    <!-- Date Range Selector -->
    <form method="get" style="margin: 20px 0; padding: 15px; background: #f8f8f8; border-radius: 4px;">
        <label for="days">Select Period:</label>
        <select name="days" style="padding: 5px 10px;">
            <option value="7">Last 7 days</option>
            <option value="30" selected>Last 30 days</option>
            <option value="90">Last 90 days</option>
        </select>
        <button type="submit"
            style="padding: 5px 15px; margin-left: 10px; background: #417690; color: white; border: none; border-radius: 3px;">Update</button>
        <a href="{% url 'admin:orders-analytics' %}?days={{ days }}"
            style="margin-left: 20px; padding: 5px 15px; text-decoration: none;">‚Üê Back to Dashboard</a>
    </form>

    <!-- Rider Earnings Table -->
    <h2>All Riders</h2>
    {% if riders_data %}
    <table style="width: 100%; border-collapse: collapse;">
        <thead>
            <tr style="background: #417690; color: white;">
                <th style="padding: 12px; text-align: left;">Rider</th>
                <th style="padding: 12px; text-align: right;">Deliveries</th>
                <th style="padding: 12px; text-align: right;">Total Earnings</th>
                <th style="padding: 12px; text-align: right;">Avg/Delivery</th>
            </tr>
        </thead>
        <tbody>
            {% for rider in riders_data %}
            <tr {% if forloop.counter|divisibleby:2 %}style="background: #f8f8f8;" {% endif %}>
                <td style="padding: 10px; border-bottom: 1px solid #ddd;">
                    <strong>{{ rider.username }}</strong><br>
                    <small style="color: #666;">{{ rider.email }}</small>
                </td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">{{ rider.deliveries_count
                    }}</td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right; color: #17a2b8;"><strong>{{
                        rider.total_earnings }} SAR</strong></td>
                <td style="padding: 10px; border-bottom: 1px solid #ddd; text-align: right;">{{ rider.avg_per_delivery
                    }} SAR</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p style="padding: 20px; background: #fff3cd; border: 1px solid #ffc107; border-radius: 4px;">No rider earnings data
        found for this period.</p>
    {% endif %}

    <p style="margin-top: 30px; color: #666; font-size: 12px;">
        <em>Data is cached for 5 minutes. Showing data for last {{ days }} days.</em>
    </p>
</div>
{% endblock %}