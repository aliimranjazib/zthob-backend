{% extends "admin/change_list.html" %}
{% load i18n static admin_list %}

{% block content_title %}
<h1>{{ title }}</h1>
{% endblock %}

{% block result_list %}
{% if dashboard_stats %}
<!-- Admin Dashboard Analytics Header -->
<div
    style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 25px; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2
            style="margin: 0; color: #333; font-size: 18px; border-bottom: 2px solid #007bff; display: inline-block; padding-bottom: 5px;">
            <i class="fas fa-chart-line"></i> Global Performance Dashboard
        </h2>
        <a href="dashboard-analytics/" class="button"
            style="background: #007bff; color: white; padding: 10px 20px; border-radius: 4px; text-decoration: none; font-weight: bold; font-size: 13px;">
            <i class="fas fa-expand-arrows-alt"></i> VIEW FULL DASHBOARD
        </a>
    </div>

    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 15px;">
        <!-- Revenue Cards -->
        <div
            style="flex: 1; min-width: 200px; background: white; padding: 15px; border-radius: 6px; border-left: 5px solid #28a745; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="color: #6c757d; font-size: 13px; text-transform: uppercase; font-weight: bold;">Gross Revenue
            </div>
            <div style="font-size: 24px; font-weight: bold; color: #28a745; margin-top: 5px;">SAR {{
                dashboard_stats.financials.gross_revenue|floatformat:2 }}</div>
            <div style="font-size: 11px; color: #999; margin-top: 5px;">Valid Orders Only</div>
        </div>

        <div
            style="flex: 1; min-width: 200px; background: white; padding: 15px; border-radius: 6px; border-left: 5px solid #17a2b8; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="color: #6c757d; font-size: 13px; text-transform: uppercase; font-weight: bold;">System Fees
                (Earnings)</div>
            <div style="font-size: 24px; font-weight: bold; color: #17a2b8; margin-top: 5px;">SAR {{
                dashboard_stats.financials.system_fees|floatformat:2 }}</div>
            <div style="font-size: 11px; color: #999; margin-top: 5px;">Our Platform Commission</div>
        </div>

        <div
            style="flex: 1; min-width: 200px; background: white; padding: 15px; border-radius: 6px; border-left: 5px solid #ffc107; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="color: #6c757d; font-size: 13px; text-transform: uppercase; font-weight: bold;">Avg. Order Value
            </div>
            <div style="font-size: 24px; font-weight: bold; color: #ffc107; margin-top: 5px;">SAR {{
                dashboard_stats.overview.avg_order_value|floatformat:2 }}</div>
            <div style="font-size: 11px; color: #999; margin-top: 5px;">Efficiency Metric</div>
        </div>

        <div
            style="flex: 1; min-width: 200px; background: white; padding: 15px; border-radius: 6px; border-left: 5px solid #6f42c1; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div style="color: #6c757d; font-size: 13px; text-transform: uppercase; font-weight: bold;">Total Orders
            </div>
            <div style="font-size: 24px; font-weight: bold; color: #6f42c1; margin-top: 5px;">{{
                dashboard_stats.overview.total_orders }}</div>
            <div style="font-size: 11px; color: #999; margin-top: 5px;">All Time Volume</div>
        </div>
    </div>

    <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px;">
        <!-- Top Tailors Table -->
        <div
            style="flex: 2; min-width: 300px; background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div
                style="color: #333; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                Top Tailors Earning</div>
            <table style="width: 100%; border-collapse: collapse; font-size: 13px;">
                <thead>
                    <tr style="text-align: left; border-bottom: 2px solid #eee;">
                        <th style="padding: 8px;">Tailor</th>
                        <th style="padding: 8px;">Orders</th>
                        <th style="padding: 8px;">Revenue</th>
                    </tr>
                </thead>
                <tbody>
                    {% for tailor in dashboard_stats.tailor_earnings|slice:":5" %}
                    <tr style="border-bottom: 1px solid #f9f9f9;">
                        <td style="padding: 8px;">{{ tailor.tailor__username }}</td>
                        <td style="padding: 8px;">{{ tailor.order_count }}</td>
                        <td style="padding: 8px; font-weight: bold; color: #28a745;">SAR {{
                            tailor.total_revenue|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Top Fabrics -->
        <div
            style="flex: 1; min-width: 250px; background: white; padding: 15px; border-radius: 6px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
            <div
                style="color: #333; font-weight: bold; margin-bottom: 10px; border-bottom: 1px solid #eee; padding-bottom: 5px;">
                Best Selling Fabrics</div>
            <ul style="list-style: none; padding: 0; margin: 0; font-size: 13px;">
                {% for fabric in dashboard_stats.top_fabrics|slice:":5" %}
                <li
                    style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f9f9f9;">
                    <span>{{ fabric.fabric__name }}</span>
                    <span style="font-weight: bold; color: #007bff;">{{ fabric.total_sold }} sold</span>
                </li>
                {% endfor %}
            </ul>
        </div>
    </div>
</div>
{% endif %}

{{ block.super }}
{% endblock %}